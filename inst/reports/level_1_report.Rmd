---
title: "FluvialGeomorph Level 1 Report"
params:
  stream: ""
  flowline_sf: ""
  cross_section_sf: ""
  features_sf: ""
  flowline_points_sf_list: ""
  xs_points_sf_list: ""
  profile_units: ""
  aerial: TRUE
  elevation: FALSE
  xs_label_freq: 5
  exaggeration: 10
  extent_factor: 1.1
  output_format: ""
---

```{r library, eval=TRUE, include=FALSE}
library(sf)
library(dplyr)
library(purrr)
library(knitr)
library(rmarkdown)
library(ggplot2)
library(ggrepel)
library(tmap)
```

## Study Area Overview
```{r aerial_overview, echo=FALSE, warning=FALSE, message=FALSE, results="hide", fig.width=7, fig.height=7, fig.cap="Reach Overview Map"}
if(aerial) {
  print(fluvgeo::map_reach_overview(flowline = params$flowline_sf, 
                                    cross_section = params$cross_section_sf,
                                    background = "aerial",
                                    xs_label_freq = params$xs_label_freq,
                                    extent_factor = params$extent_factor))
}
```

```{r elevation_overview, echo=FALSE, warning=FALSE, message=FALSE, results="hide", fig.width=7, fig.height=7, fig.cap="Reach Elevation Map"}
if(elevation) {
  print(fluvgeo::map_reach_overview(flowline = flowline_sf, 
                                    cross_section = params$cross_section_sf,
                                    background = "elevation",
                                    xs_label_freq = params$xs_label_freq,
                                    exaggeration = params$exaggeration,
                                    extent_factor = params$extent_factor))
}
```

## Longitudinal Profile
```{r long_profile, echo=FALSE, fig.width=7, fig.height=5, fig.cap="Longitudinal Profile Plot"}
print(fluvgeo::compare_long_profile(stream = params$stream,
                                    flowline_pts_sf_list = flowline_pts_sf_list,
                                    features_sf = params$features_sf,
                                    profile_units = params$profile_units))
```

```{r xs_long_profile, echo=FALSE, fig.width=7, fig.height=5, fig.cap="XS Longitudinal Profile Plot"}
print(compare_xs_long_profile(stream = params$stream,
                              xs_pts_sf_list = params$xs_points_sf_list,
                              features_sf = params$features_sf,
                              profile_units = params$profile_units))
```

## Cross Section Metrics
```{r, xs_metrics_plot, eval=TRUE, echo=FALSE, results='asis', fig.width=7, fig.height=9, fig.cap="Cross Section Metrics Plot.", warning=FALSE}
print(L1_metrics <- xs_metrics_plot_L1(xs_dims_sf = params$cross_section_sf,
                                       features_sf = features_sf,
                                       profile_units = params$profile_units))
```


## Cross Section Profiles
```{r cross_section_plots, echo=FALSE, results='asis', fig.width=7, fig.height=5}
cross_section <- dplyr::arrange(params$cross_section_sf, Seq)

# Iterate through cross sections
for(i in unique(cross_section$Seq)) {
  print(fluvgeo::xs_compare_plot(stream = stream,
                                 xs_number = i,
                                 xs_pts_sf_list = xs_pts_sf_list))
  # Insert vertical white space so that next figure in loop is recognized
  cat('\n')
  # Must set chunk option`results='asis'` to ensure table is drawn properly
}
```

Version: 0.1.29

